<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nadi AI - Demo Web</title>
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Recharts for charts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6">
    <div id="root" class="w-full max-w-3xl bg-white shadow-xl rounded-2xl p-8"></div>

    <script type="text/babel">
      const { useState } = React;
      const { PieChart, Pie, Cell, Tooltip } = Recharts;

      const ONLINE_MAPPING_URL = "https://example.com/pulse_to_bloodgroup.json"; // replace with your real online JSON

      const App = () => {
        const [bpm, setBpm] = useState(72);
        const [rhythm, setRhythm] = useState("regular");
        const [gender, setGender] = useState("male");
        const [mapping, setMapping] = useState(null);
        const [result, setResult] = useState(null);
        const [status, setStatus] = useState("");

        const fetchMapping = async () => {
          setStatus("Fetching online blood group mapping...");
          try {
            const res = await axios.get(ONLINE_MAPPING_URL);
            setMapping(res.data);
            setStatus("Online mapping loaded successfully ✅");
          } catch (err) {
            setStatus("Failed to fetch mapping ❌ (check your URL)");
          }
        };

        const matchBloodGroup = () => {
          if (!mapping || !mapping.mappings) {
            setStatus("Mapping not loaded yet!");
            return;
          }
          const match = mapping.mappings.find(
            (m) =>
              (m.pulse_pattern.toLowerCase() === rhythm ||
                m.pulse_pattern.toLowerCase() === "any") &&
              bpm >= m.bpm_min &&
              bpm <= m.bpm_max
          );
          return match ? match.blood_group : "Unknown";
        };

        const generateDemo = () => {
          const bloodGroup = matchBloodGroup() || "Unknown";
          const rand = (min, max) => +(Math.random() * (max - min) + min).toFixed(1);

          const sugar = rand(70, 160);
          const systolic = rand(95, 150);
          const diastolic = rand(60, 95);
          const spo2 = rand(92, 99);

          const data = { bloodGroup, sugar, systolic, diastolic, spo2 };

          if (gender === "male") {
            const risk =
              5 +
              (bpm - 60) * 0.6 +
              Math.max(0, sugar - 90) * 0.2 +
              Math.max(0, systolic - 120) * 0.3 +
              (rhythm === "irregular" ? 10 : 0);
            data.heartRisk = Math.min(99, +(risk + rand(-5, 5)).toFixed(1));
          } else {
            let prob = 5;
            if (rhythm === "irregular") prob += 8;
            if (spo2 < 96) prob += 5;
            prob = Math.min(95, prob + rand(-3, 10));
            data.pregnancyProb = +prob.toFixed(1);
            data.pregnancyPositive = prob > 20 && Math.random() < prob / 100;
          }

          setResult(data);
          setStatus("Demo results generated ✅");
        };

        return (
          <div className="space-y-6">
            <h1 className="text-3xl font-bold text-center text-blue-700">Nadi AI — Demo (Web)</h1>
            <p className="text-sm text-gray-500 text-center">
              Pulse-based AI health demo — for educational use only
            </p>

            {/* Inputs */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Pulse (BPM)</label>
                <input
                  type="number"
                  value={bpm}
                  onChange={(e) => setBpm(+e.target.value)}
                  className="mt-1 w-full border rounded-lg p-2 text-center"
                  min="30"
                  max="220"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Rhythm</label>
                <select
                  value={rhythm}
                  onChange={(e) => setRhythm(e.target.value)}
                  className="mt-1 w-full border rounded-lg p-2"
                >
                  <option value="regular">Regular</option>
                  <option value="irregular">Irregular</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Gender</label>
                <select
                  value={gender}
                  onChange={(e) => setGender(e.target.value)}
                  className="mt-1 w-full border rounded-lg p-2"
                >
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </div>
            </div>

            {/* Buttons */}
            <div className="flex justify-center space-x-3">
              <button
                onClick={fetchMapping}
                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
              >
                Fetch Mapping
              </button>
              <button
                onClick={generateDemo}
                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg"
              >
                Generate Demo
              </button>
            </div>

            {/* Status */}
            {status && <p className="text-sm text-gray-600 text-center">{status}</p>}

            {/* Results */}
            {result && (
              <div className="bg-gray-50 p-4 rounded-xl shadow-inner space-y-3">
                <h2 className="text-xl font-semibold text-gray-800 text-center mb-2">
                  Diagnostic Report
                </h2>
                <div className="grid grid-cols-2 gap-4 text-center">
                  <div className="bg-white rounded-lg p-3 shadow-sm">
                    <p className="text-sm text-gray-500">Blood Group</p>
                    <p className="text-xl font-bold text-blue-700">{result.bloodGroup}</p>
                  </div>
                  <div className="bg-white rounded-lg p-3 shadow-sm">
                    <p className="text-sm text-gray-500">Sugar (mg/dL)</p>
                    <p className="text-xl font-bold">{result.sugar}</p>
                  </div>
                  <div className="bg-white rounded-lg p-3 shadow-sm">
                    <p className="text-sm text-gray-500">Blood Pressure</p>
                    <p className="text-xl font-bold">
                      {result.systolic}/{result.diastolic}
                    </p>
                  </div>
                  <div className="bg-white rounded-lg p-3 shadow-sm">
                    <p className="text-sm text-gray-500">SpO₂ (%)</p>
                    <p className="text-xl font-bold">{result.spo2}</p>
                  </div>
                </div>

                {/* Conditional output */}
                {gender === "male" ? (
                  <div className="mt-6 text-center">
                    <h3 className="text-lg font-semibold text-gray-700 mb-2">
                      Heart Attack Risk (%)
                    </h3>
                    <PieChart width={220} height={180}>
                      <Pie
                        dataKey="value"
                        data={[
                          { name: "Risk", value: result.heartRisk },
                          { name: "Safe", value: 100 - result.heartRisk },
                        ]}
                        cx="50%"
                        cy="50%"
                        innerRadius={50}
                        outerRadius={70}
                        paddingAngle={5}
                      >
                        <Cell fill="#dc2626" />
                        <Cell fill="#16a34a" />
                      </Pie>
                      <Tooltip />
                    </PieChart>
                    <p className="text-xl font-bold text-red-600">
                      {result.heartRisk.toFixed(1)}%
                    </p>
                  </div>
                ) : (
                  <div className="mt-6 text-center">
                    <h3 className="text-lg font-semibold text-gray-700 mb-2">
                      Pregnancy Probability (%)
                    </h3>
                    <PieChart width={220} height={180}>
                      <Pie
                        dataKey="value"
                        data={[
                          { name: "Probability", value: result.pregnancyProb },
                          { name: "None", value: 100 - result.pregnancyProb },
                        ]}
                        cx="50%"
                        cy="50%"
                        innerRadius={50}
                        outerRadius={70}
                        paddingAngle={5}
                      >
                        <Cell fill="#2563eb" />
                        <Cell fill="#d1d5db" />
                      </Pie>
                      <Tooltip />
                    </PieChart>
                    <p
                      className={`text-xl font-bold ${
                        result.pregnancyPositive ? "text-green-600" : "text-gray-600"
                      }`}
                    >
                      {result.pregnancyPositive ? "Positive" : "Negative"}
                    </p>
                  </div>
                )}
              </div>
            )}

            {/* Disclaimer */}
            <p className="text-xs text-center text-red-500 mt-4">
              ⚠️ Demo only — not a medical device or diagnostic tool.
            </p>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
      const ONLINE_MAPPING_URL = "https://github.com/maniarasan-prog/nadi-ai/blob/main/fetch.json";

    </script>
  </body>
</html>
